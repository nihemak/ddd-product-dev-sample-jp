# イテレーション 2025-W20 バックログ

* **期間:** 2025-05-11 - 2025-05-17
* **ゴール:**
  1. フロントエンド開発環境のクリーンアップ・安定化を行い、今後の機能開発の土台を整える。

## タスクリスト (優先度順)

* **(計画時/各タスク開始前) ゴール確認とサブタスク分解:** 各タスクについて、目的・ゴールを明確にし、具体的なサブタスクに分解したか？
* [ ] `1. chore(frontend): フロントエンド開発環境のクリーンアップを行う` *(Ref: docs/technical_tasks.md#フロントエンド環境のクリーンアップ)*
  * **ゴール:** Next.js やその他関連ライブラリ（Tailwind CSS, shadcn/ui など）を、DevContainer 環境下で公式のインストール手順や推奨される方法に従って再セットアップし、現状のアプリケーション（ヘルスチェックページ表示など）が正常に動作する、クリーンで安定した開発環境を構築する。
  * **スコープ:**
    * Next.js, Tailwind CSS, shadcn/ui および関連する主要ライブラリの再インストール・設定。
    * DevContainer 環境での動作確認（ビルド、Storybook 起動、ヘルスチェックページの表示）。
    * 既存のスタイリング問題（DatePicker の背景透過など）が、このクリーンアップによって解消されるかの確認。
    * **スコープ外:** 新機能の追加、テスト基盤のセットアップ（別タスクとする）、既存コードの大規模なリファクタリング（クリーンアップに伴う軽微な修正は含む）。
  * **サブタスク:**
    * **フェーズ 0: Gitブランチの準備**
      * [x] 0.1. `feat/frontend-env-cleanup` ブランチを作成し、チェックアウトする。
    * **フェーズ 1: 準備と現状把握**
      * [x] 1.1. 現状の `frontend/` 主要設定ファイル (`package.json`, `next.config.js`, `tailwind.config.js`, `postcss.config.js`, `.eslintrc.json`, `tsconfig.json`, Storybook関連) の内容を確認し、カスタマイズ箇所を把握する。
      * [x] 1.2. `frontend` ディレクトリ全体のバックアップを作成する。
      * [x] 1.3. フェーズ1の変更をコミットし、リモートにプッシュする。
    * **フェーズ 2: 依存関係のクリーンアップと再定義**
      * [x] 2.1. `frontend/node_modules` ディレクトリと `package-lock.json` を削除する。
      * [x] 2.2. `package.json` の `dependencies` と `devDependencies` を見直し、Next.js, React, Tailwind CSS等の主要ライブラリのバージョンを最新安定版に更新する。不要な依存は削除/コメントアウトする。
      * [x] 2.3. フェーズ2の変更をコミットし、リモートにプッシュする。
    * **フェーズ 3: 設定ファイルの初期化と段階的再構築**
      * [x] 3.1. 主要設定ファイル (`next.config.js`, `tailwind.config.js`, `postcss.config.js`, `.eslintrc.json`, `tsconfig.json`, Storybook関連) の内容を空にするか最小テンプレートで上書き (バックアップ必須)。
      * [x] 3.2. Next.js 設定 (`next.config.js`, `tsconfig.json`) を公式ドキュメントベースで最小限から再構築し、必要なカスタム設定を段階的に追加・検証する。 (`.ts` から `.mjs` への変更経緯もここで確認)
      * [x] 3.3. Tailwind CSS 設定 (`tailwind.config.js`, `postcss.config.js`) を `npx tailwindcss init -p` で再生成後、必要なカスタム設定を段階的に追加・検証する。
      * [x] 3.4. ESLint/Prettier 設定を Next.js 推奨ベースで再構築し、必要なカスタムルールを移行・検証する。 (`eslint-config-next` の問題もここで対応)
      * [x] 3.5. Storybook 設定 (`.storybook/main.js`, `.storybook/preview.js`) を公式ドキュメントベースで最小限から再構築し、必要なカスタム設定を段階的に追加・検証する。
      * [x] 3.6. フェーズ3の変更をコミットし、リモートにプッシュする。
    * **フェーズ 4: shadcn/ui の再セットアップ**
      * [x] 4.1. `components.json` (shadcn/ui用) の設定を確認する。
      * [x] 4.2. 既存 `shadcn/ui` コンポーネントを `npx shadcn@latest add <component>` で再追加し、設定とスタイルを最新化する (既存カスタマイズのマージに注意)。
      * [x] 4.3. フェーズ4の変更をコミットし、リモートにプッシュする。
    * **フェーズ 5: 依存関係のインストールと動作確認**
      * [x] 5.1. `npm install` を実行する。
      * [x] 5.2. Next.js開発サーバー (docker composeで起動) が正しく動作し、ブラウザでヘルスチェックページ等の基本動作とスタイルを確認する。
      * [x] 5.3. Storybook (docker composeで起動) が正しく動作し、ブラウザで主要コンポーネントの表示とスタイル(DatePicker背景透過等)を確認する。
      * [x] 5.4. ESLint/Prettierが正しく動作することを確認する。
      * [x] 5.5. フェーズ5の変更をコミットし、リモートにプッシュする。
    * **フェーズ 6: DevContainer 設定の確認とドキュメント更新**
      * [x] 6.1. `.devcontainer/devcontainer.json` や関連 Dockerfile が新しい環境設定と整合しているか確認・調整する。
      * [x] 6.2. セットアップ手順や依存関係に変更があれば `frontend/README.md` 等を更新する。
      * [x] 6.3. フェーズ6の変更をコミットし、リモートにプッシュする。
      * [x] 6.4. `frontend_backup` ディレクトリを削除する。
    * **フェーズ 7: マージとクリーンアップ**
      * [x] 7.1. `main` ブランチに `feat/frontend-env-cleanup` ブランチをマージする。
      * [x] 7.2. (任意) `feat/frontend-env-cleanup` ブランチを削除する。
* [ ] `2. feat(testing): フロントエンドテスト基盤をセットアップする` *(Ref: docs/technical_tasks.md#feat-testing-フロントエンドテストツールの導入と初期テスト作成, docs/architecture/adr/0020-use-vitest-rtl-storybook-for-frontend-unit-testing.md, docs/architecture/adr/0021-use-playwright-for-frontend-e2e-testing.md)*
  * **ゴール:** ADR 0020 (ユニット/コンポーネントテスト戦略) および ADR 0021 (E2Eテスト戦略) で決定されたテスト戦略に基づき、フロントエンドプロジェクトに Vitest, React Testing Library (RTL), Storybook Interaction Tests, Playwright を導入・設定する。それぞれのツールで基本的なサンプルテストを作成し、ローカル開発環境 (DevContainer) で実行できる状態にする。また、CIでのユニットテスト実行に向けた準備を行う。
  * **スコープ:**
    * Vitest および React Testing Library の導入と設定、簡単なコンポーネントテストの作成と実行。
    * Storybook Interaction Tests のセットアップと、既存ストーリーへの簡単なインタラクションテストの追加。
    * Playwright の導入と設定、ブラウザバイナリのインストール（DevContainer内）、簡単なE2Eテストの作成と実行。
    * 各テストを実行するためのnpmスクリプトの追加。
    * CIでのユニットテスト実行用スクリプトの準備。
    * 関連ドキュメント（READMEなど）へのテスト実行方法の追記。
  * **スコープ外:**
    * アプリケーション全体の網羅的なテストケースの作成。
    * 高度なモック戦略の策定や実装。
    * テストカバレッジレポートの詳細な設定とCIへの統合。
    * CIワークフローファイル (`.github/workflows/ci.yml` など) の直接的な編集とテスト実行パイプラインの完全な構築 (これは別途CIタスクで扱う)。
  * **サブタスク:**
    * **1. Vitest + React Testing Library (RTL) のセットアップ:**
      * [x] 1.1. `package.json` に `vitest`, `@vitest/ui`, `jsdom`, `@testing-library/react`, `@testing-library/jest-dom`, `happy-dom` (または `jsdom` の代替/補完として検討)等の必要な依存関係を追加する。
      * [x] 1.2. `vitest.config.ts` (または `vite.config.ts` 内に) を作成・設定し、React環境用の設定、テスト環境 (`jsdom` または `happy-dom`)、グローバルセットアップ (例: `@testing-library/jest-dom/extend-expect`) を構成する。
      * [x] 1.3. `frontend/src/components/features/HealthCheck/HealthCheckDisplay.tsx` (または他の適切なコンポーネント) に対する基本的なユニット/コンポーネントテスト (`*.test.tsx`) を作成する。
      * [x] 1.4. テスト実行用のnpmスクリプト (例: `test:unit`, `test:unit:ui`) を `package.json` に追加し、ローカルでテストが実行でき、`@vitest/ui` で結果を確認できることを確認する。
    * **2. Storybook Interaction Tests のセットアップ:**
      * [x] 2.1. `package.json` に `@storybook/test` (必要に応じて `@storybook/jest` やアサーションライブラリ) の依存関係を追加/確認する。
      * [x] 2.2. 既存の単純なUIコンポーネントのStorybookストーリー (例: `Button.stories.tsx`) に、`play` 関数を用いた簡単なインタラクションテストを追加する。
      * [x] 2.3. Storybook上でインタラクションテストが実行され、結果が確認できることを確認する。
    * **3. Playwright のセットアップ:**
      * [x] 3.1. `package.json` に `@playwright/test` の依存関係を追加する。
      * [x] 3.2. DevContainer内で `npx playwright install --with-deps` (または必要なブラウザのみを指定) を実行し、ブラウザバイナリとOS依存関係をインストールする (必要に応じて `.devcontainer/devcontainer.json` の `postCreateCommand` や Dockerfile の調整を検討)。
      * [x] 3.3. `playwright.config.ts` を作成・設定し、基本的なプロジェクト設定 (例: `baseURL`, `projects` でのブラウザ指定) を行う。
      * [x] 3.4. ヘルスチェックページ (`/health`) を表示し、特定のテキストが存在することを確認する簡単なE2Eテスト (`*.spec.ts`) を作成する。
      * [ ] 3.5. テスト実行用のnpmスクリプト (例: `test:e2e`, `test:e2e:ui`) を `package.json` に追加し、ローカルでテストが実行でき、Playwright UI Mode (`--ui`) やTrace Viewerが利用できることを確認する。
    * **4. CI連携準備:**
      * [x] 4.1. Vitestでのユニット/コンポーネントテストをCI環境で非インタラクティブに実行するためのnpmスクリプト (例: `test:unit:ci`) を `package.json` に追加する。
    * **5. ドキュメント更新:**
      * [x] 5.1. `frontend/README.md` または開発者向けドキュメントに、各テストのセットアップ手順の概要とローカルでの実行方法を追記する。

## イテレーション間活動記録 (任意)

* (前のイテレーション終了後、今回の計画開始までに実施したこと。例: 技術タスク消化、ドキュメント整理、学習など)

---

*(イテレーション完了時に以下を確認・記入)*
---

## 次期イテレーション (2025-W21) 検討タスク

* [ ] `2. feat(frontend): ユーザーアカウント管理（登録・ログイン）機能の要件・仕様整理` *(Ref: docs/product/roadmap.md#ユーザーアカウント管理, docs/requirements/user_story_mapping.md#バックボーン-アカウント登録を行う)*
  * **ゴール:** (このタスクで達成したい状態を具体的に記述)
  * **スコープ:** (何をどこまでやるか、何をやらないかを明確に記述)
  * **サブタスク:**
    * [ ] `(サブタスク1)`
    * [ ] `(サブタスク2)`
    * ...

## レビューまとめ

* **イテレーションゴール達成度:** (達成 / 一部達成 / 未達)
  * 目標: (計画時のゴールを再掲)
  * 結果: (達成状況を具体的に記述)
* **完了した主要タスク/成果物:**
  * (完了したタスクリストNo. や主要な成果物を記載)
* **特記事項・次への影響:**
  * (予定外の作業、発生した課題、次のイテレーションへの申し送り事項など)

## イテレーション完了時チェックリスト

* [ ] **技術タスク同期:** イテレーション中に発生/完了した技術タスクは `docs/technical_tasks.md` に反映したか？
* [ ] **ドメイン知識同期:**
  * [ ] 新しい用語や定義、ルールの変更は `docs/domain/ubiquitous-language.md` に反映したか？
  * [ ] ドメインモデルの構造に変更はあったか？ あれば `docs/domain/domain-model.md` に反映したか？
* [ ] **その他ドキュメント同期:**
  * [ ] プロジェクト概要や使い方に変更はあったか？ あれば `README.md` に反映したか？
  * [ ] 開発プロセスやガイドラインに変更はあったか？ あれば関連ドキュメント (`docs/process/`, `docs/PRODUCT_DEVELOPMENT_GUIDE.md` など) に反映したか？
  * [ ] プロダクト定義 (`docs/product/`) や要求定義 (`docs/requirements/`) に影響する変更はなかったか？ (あれば更新 or 次期タスク化)
* [ ] **ADR同期:** 新たなアーキテクチャ決定は ADR (`docs/architecture/adr/`) として記録したか？
* [ ] **DBスキーマ同期:** (DB変更があった場合) `docs/db/schema.sql` 及び `docs/db/er-diagram.md` は最新の状態か？ マイグレーションファイルは作成/適用済みか？
* [ ] **AIアシスタントルールレビュー:** AIアシスタントのルール (`@rules` や `.cursor/rules/` 内ファイル) に変更や追加の必要性がないか確認したか？ (必要であればAIにレビューを依頼)

## 振り返り (Retrospective)

* **Keep (良かったこと):**
  * [ ]
* **Problem (問題点・課題):**
  * [ ]
* **Try (次に試すこと):**
  * [ ]
* **戦略への示唆 (任意):**
  * [ ] 今回の学びや課題から、プロダクト戦略/ロードマップ (`docs/product/`) の見直しに繋がりそうな点はあったか？ (あれば戦略レビューのインプット候補)
  * [ ] 次回の戦略レビューに向けて、意識的に収集・観察すべきデータやユーザーの声は何か？
