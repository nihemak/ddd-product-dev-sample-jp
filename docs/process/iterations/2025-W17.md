# イテレーション 2025-W17 バックログ

*   **期間:** 2025-04-22 - 2025-04-28
*   **ゴール:** 本来のプロダクトドメイン（記念日プレゼント予約）の基本的なモデル定義を行い、既存サンプルコードをコードベースから整理・削除する。テーブル設計記録方法とDBマイグレーション、CIのプロセス基盤を確立する。

## タスクリスト (優先度順)

1.  [x] `docs(chore): 既存の技術選定・決定事項を関連ドキュメント(ADR, README等)に反映・整理する`
2.  [x] `docs(process): テーブル設計（データモデリング）の記録方法を決定する` (ADR or Doc) *(Ref: technical_tasks.md#開発プロセス・ドキュメント)*
    *   **決定:** スキーマ定義は `docs/db/schema.sql` (DDL形式) で管理し、主要な関連性は `docs/db/er-diagram.md` (Mermaid) で補足する。マイグレーションは別途ツール (`sqlx-cli` 予定) で管理する。
3.  [x] `docs(domain): 「記念日プレゼント予約」ドメインモデル (`domain-model.md`) をレビューし、コア部分を更新する` *(Focus on core entities/VOs needed initially)*
4.  [x] `docs(domain): 「記念日プレゼント予約」関連のユビキタス言語 (`ubiquitous-language.md`) をレビューし、コア部分を更新する`
5.  [x] `refactor(all): 古い注文サンプル実装を削除し、「記念日プレゼント予約」基本型定義を追加 (`domain.rs` から依存コード含め整理しコンパイルを通す)` *(Ref: technical_tasks.md#実装・リファクタリング)*
6.  [x] `feat(db): DBマイグレーションツール(sqlx-cli)を導入し、マイグレーションプロセスを確立する (空 or 最小限の初期マイグレーション作成)`
7.  [x] `chore(ci): GitHub Actions等で基本的なCIパイプライン(fmt, clippy, test)を構築する` *(Ref: technical_tasks.md#環境構築・CI/CD)*
8.  [x] `docs(adr): ADR 0001 (オニオンアーキテクチャ) の内容を現状に合わせて見直す` *(Ref: technical_tasks.md#開発プロセス・ドキュメント)*
9.  [x] `docs(adr): ADR 0002 (mockall採用) の内容を現状に合わせて見直す` *(Ref: technical_tasks.md#開発プロセス・ドキュメント)*

## レビューまとめ

*   **イテレーションゴール達成度:** 達成
    *   目標: 本来のプロダクトドメイン（記念日プレゼント予約）の基本的なモデル定義を行い、既存サンプルコードをコードベースから整理・削除する。テーブル設計記録方法とDBマイグレーション、CIのプロセス基盤を確立する。
    *   結果: 関連タスク (No.1-9) をすべて完了し、ゴールを達成できた。
*   **完了した主要タスク/成果物:**
    *   プロダクト定義/要求/ドメイン関連ドキュメントの整理・更新 (タスク1, 3, 4)
    *   テーブル設計記録方法の決定 (タスク2)
    *   サンプルコード削除と基本型定義 (タスク5)
    *   DBマイグレーションツール導入と初期マイグレーション作成 (タスク6)
    *   基本的なCIパイプライン構築 (タスク7)
    *   ADR 0001, 0002 の見直しと更新 (タスク8, 9)
*   **特記事項・次への影響:**
    *   CI設定やDocker環境で試行錯誤があったが、基盤は構築できた。最適化は今後の技術タスクとして `technical_tasks.md` に追加済み。
    *   `#[allow]` で抑制した Clippy 警告があり、これも技術タスクとして追加済み。

## 振り返り (Retrospective)

*   **Keep (良かったこと):**
    *   [ ] イテレーション計画があったことで、やるべきことが明確で進めやすかった（迷ったら戻れた）。
    *   [ ] ドメインモデルやユビキタス言語のドキュメントを早期に整備・更新し、認識を合わせながら進められた。
    *   [ ] DBマイグレーション (`sqlx-cli`) や基本的なCI (`GitHub Actions`) といったプロセス基盤を確立できた。
    *   [ ] AIとのペアプロの雰囲気を掴むことができた。協力して Docker 環境や CI の問題を解決できた。
    *   [ ] イミュータブル DB や CI 戦略などの技術的な検討を行い、決定事項や将来の課題を記録できた。
*   **Problem (問題点・課題):**
    *   [ ] イテレーション計画の精度が十分でなく、期間中にやる内容の変更が発生した (本来は避けるべき)。
    *   [ ] 計画外の作業を実施してしまった (スコープクリープ)。(例: 基本型定義以上の実装)
    *   [ ] CI 設定で試行錯誤が多く、時間を使った (working directory, lint エラー, `cargo fix` の挙動など)。
    *   [ ] Docker 環境設定 (ボリューム同期など) の理解と設定に時間がかかった。
    *   [ ] Web フレームワークの変更 (Actix-Web → Axum) の経緯が不明瞭になった。
    *   [ ] ペアプロ中に AI が文脈 (Docker 環境前提など) を見失う場面があった。
    *   [ ] コミットやドキュメント化が、作業の区切りごとではなく、後でまとめて行う場面があった。
*   **Try (次に試すこと):**
    *   [ ] 次回のイテレーション計画は、開始前により時間をかけて検討し、精度を高める。
    *   [ ] イテレーション中はスコープを意識し、変更が必要な場合は明確に合意・記録する。
    *   [ ] 大きな技術変更を行う際は、ADR などで理由と経緯を明確に記録する。
    *   [ ] AI とのペアプロでは、前提条件が変わった場合や AI が文脈を見失ったと感じた場合に、より明確に状況を伝えるようにする (AI 側も改善に努める)。
    *   [ ] 意味のある作業の区切りで、こまめにコミット・ドキュメント化を行うことを意識する。
    *   [ ] CI 設定の改善タスク (キャッシュ、トリガー最適化) を計画的に実施する (`technical_tasks.md`)。
    *   [ ] `#[allow]` で抑制した Clippy 警告のリファクタリングタスクを計画的に消化する (`technical_tasks.md`)。
    *   [ ] Docker 環境設定や CI 設定で得た知見をドキュメント化・共有する。 