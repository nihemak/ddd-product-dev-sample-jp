# イテレーション 2025-W19 バックログ

- **期間:** 2025-05-04 - 2025-05-10
- **ゴール:** 「プレゼント予約」画面を例として、Storybook と Markdown による画面仕様定義プロセスを確立する。併せて、フロントエンドの基本的なアーキテクチャ方針とテスト戦略を決定する。

## タスクリスト (優先度順)

1. [x] `docs(architecture): フロントエンドのアーキテクチャ方針を決定し、ADRとして記録する` _(Ref: technical_tasks.md#アーキテクチャ・技術選定)_
2. [x] `docs(ui): 「プレゼント予約（発送代行）」画面の仕様（画面定義・主要コンポーネント）をドキュメント化する (Storybook+MD)` _(Ref: technical_tasks.md#開発プロセス・ドキュメント, user_story_mapping.md#バックボーン-プレゼント予約を行う発送代行)_
3. [x] `chore(dev-env): 開発環境を Dev Container に移行する` _(Ref: technical_tasks.md#環境構築・CI/CD)_
4. [x] `feat(frontend): 「プレゼント予約（発送代行）」画面の基本UIコンポーネントを Storybook に作成する (shadcn/ui 活用)` _(DatePicker まで完了。Dev Container 導入後に再開)_
    - **ゴール:** `docs/ui/present-reservation-shipping-proxy.md` の「4. コンポーネント詳細と振る舞い」記載の基本 UI コンポーネントについて、React コンポーネント(`.tsx`)と Storybook ストーリー(`.stories.tsx`)を作成し、Storybook 上で個別に表示・確認できる状態にする。
    - **スコープ外:** 画面全体のレイアウト構築、API 連携、複雑な状態管理。
    - **サブタスク:**
        - [x] `Select` コンポーネント (`届け先選択`) の作成と Storybook ストーリー作成・確認。
        - [x] `DatePicker` コンポーネント (`記念日入力`) の作成と Storybook ストーリー作成・確認。 _(前回完了済み)_
        - [x] `Textarea` コンポーネント (`メッセージ入力`, `プレゼント情報 (特記事項)`) の作成と Storybook ストーリー作成・確認。
        - [x] `Input` コンポーネント (`プレゼント情報 (品名/内容)`) の Storybook ストーリー作成・確認 (既存 `shadcn/ui` 利用)。
        - [x] `Button` コンポーネント (`予約確定ボタン`, `キャンセルボタン`) の Storybook ストーリー作成・確認 (既存 `shadcn/ui` 利用、状態含む)。
    _(Ref: docs/ui/present-reservation-shipping-proxy.md#4-コンポーネント詳細と振る舞い, docs/requirements/user_story_mapping.md#バックボーン-プレゼント予約を行う発送代行)_
5. [x] `docs(ui): 「プレゼント予約（発送代行）」画面のレイアウト確認用 Storybook ストーリーを作成する`
    - **ゴール:** Task4 で作成した基本 UI コンポーネントを仮に組み合わせ、画面全体のレイアウト構成を Storybook 上で視覚的に確認できるようにする。
    - **スコープ外:** 機能ロジックの実装。
    - **サブタスク:**
        - [x] レイアウト確認用 Storybook ストーリーファイル (`frontend/src/stories/pages/PresentReservationShippingProxyPageLayout.stories.tsx`) を作成する。
        - [x] 必要な基本 UI コンポーネントをストーリーファイルにインポートする。
        - [x] ストーリー内で、JSX と Tailwind を使用して大まかな画面レイアウト構造を実装する。
        - [x] 各コンポーネントにプレースホルダー等の基本的な props を設定する。
        - [x] DatePicker のカレンダー表示 (`calendar.tsx` 等) のスタイルを調整し、日付・曜日の幅を揃える。 _(背景透過の問題は残存するが、幅調整は不要であることを確認。詳細は技術タスクへ)_
        - [x] Storybook でレイアウトと DatePicker の表示を確認する。 _(レイアウト確認は実施。表示の不具合は別途技術タスクとして管理)_
    _(DatePicker のスタイリングに課題あり。Tailwind/React バージョン互換性の可能性を調査するため、一時中断)_
    _(Ref: docs/ui/present-reservation-shipping-proxy.md#3-レイアウト・構成)_
6. [x] `chore(frontend): Next.js 14 / Tailwind CSS v3 へダウングレードする` _(Ref: technical_tasks.md#chorefrontend-nextjs-14--tailwind-css-v3-へダウングレードする)_
    - **ゴール**:
        - Next.js を v14 系、Tailwind CSS を v3 系にダウングレードする。
        - 関連依存パッケージも互換バージョンに更新する。
        - `npm install` が正常完了する。
        - Tailwind 設定ファイルを v3 互換にする（必要なら修正）。
        - Storybook がバージョン起因のエラーなく起動し、基本コンポーネントが表示されることを確認する。
        - (スコープ外) レイアウト問題の完全解決。
    - **サブタスク**:
        - [x] `package.json` のバージョン更新。
        - [x] `node_modules` の中身削除。
        - [x] `npm install` 実行。
        - [x] Tailwind 設定ファイル確認・修正。
        - [x] Storybook 起動確認。
    - _(注釈: `eslint-config-next` を一時的に無効化することで `npm install` 問題を回避。詳細は `docs/technical_tasks.md` を参照。)_
7. [x] `docs(testing): フロントエンドのユニットテスト戦略・ツールを決定する (Jest/RTL?)` _(Ref: technical_tasks.md#開発プロセス・ドキュメント)_
    - [x] ユニットテストの基本方針（テスト対象、テストの種類、カバレッジ目標など）を議論・決定する。
    - [x] ユニットテストツール（Vitest + RTL、Storybook Interaction Testsなど）を選定する。
    - [x] 決定事項をADRとして記録する (`docs/architecture/adr/0020-use-vitest-rtl-storybook-for-frontend-unit-testing.md`)。
8. [x] `docs(testing): フロントエンドのE2Eテスト戦略・ツールを選定する (Playwright/Cypress?)` _(Ref: technical_tasks.md#開発プロセス・ドキュメント)_
    - [x] E2Eテストの基本方針（テスト対象範囲、主要シナリオ、実行頻度など）を議論・決定する。
    - [x] E2Eテストツール（Playwright, Cypressなど）を選定する。
    - [x] 決定事項をADRとして記録する (`docs/architecture/adr/0021-use-playwright-for-frontend-e2e-testing.md`)。
9. [x] `feat(frontend): フロントエンドからバックエンドのヘルスチェックAPIを呼び出すサンプルページ/コンポーネントを実装する` _(Ref: backend/src/routes/health_check.rs, docs/architecture/adr/0019-frontend-architecture-policy.md)_
    - **ゴール:**
        1. フロントエンドのサンプルページから、バックエンドのヘルスチェックAPI (`/api/health`) を呼び出し、その結果を画面に表示できる。
        2. この実装を通じて、ADR 0019 で定義されたフロントエンドアーキテクチャ方針の具体的な適用例を示す。
    - **サブタスク:**
        - [x] **(準備) OpenAPI スキーマからの API クライアント生成ツールの導入と設定:**
            - [x] `openapi-typescript-codegen` を `frontend` プロジェクトの `devDependencies` に追加する。
            - [x] `package.json` に、バックエンドの OpenAPI スキーマから API クライアントと型定義を `frontend/src/lib/api/generated/` ディレクトリに生成するためのスクリプトを追加する。
            - [x] 生成スクリプトを実行し、クライアントコードが期待通り生成されることを確認する。
        - [x] **(実装) ヘルスチェック API 呼び出し用カスタムフックの作成:**
            - [x] `frontend/src/hooks/useHealthCheck.ts` を作成する。
            - [x] フック内で、生成されたAPIクライアントを使用しヘルスチェックAPIを呼び出すロジックを実装する (React Query (`useQuery`) を使用)。
        - [x] **(実装) ヘルスチェック結果表示用コンポーネントの作成:**
            - [x] `frontend/src/components/features/HealthCheck/HealthCheckDisplay.tsx` を作成する。
            - [x] `useHealthCheck` フックを利用し、ローディング状態、APIレスポンス、エラーメッセージを表示する。
        - [x] **(実装) サンプルページの作成と React Query Provider の設定:**
            - [x] `frontend/src/app/health/page.tsx` を作成し、`HealthCheckDisplay` コンポーネントを配置する。
            - [x] `frontend/src/providers/QueryClientProviderComponent.tsx` を作成し、React Query の `QueryClient` と `QueryClientProvider` を設定する。
            - [x] `frontend/src/app/layout.tsx` で `QueryClientProviderComponent` を適用する。
        - [x] **(確認) 動作確認と ADR 0019 との整合性確認:**
            - [x] フロントエンドとバックエンドを起動し、`/health` ページでAPI呼び出しと結果表示を確認する。
            - [x] 実装が ADR 0019 の方針と整合していることを確認する。
            - [x] 実装がサンプルとして適切な範囲に収まっていることを確認する。

## イテレーション間活動記録 (任意)

- (前のイテレーション終了後、今回の計画開始までに実施したこと。例: 技術タスク消化、ドキュメント整理、学習など)

---

## _(イテレーション完了時に以下を確認・記入)_

## レビューまとめ

- **イテレーションゴール達成度:** (達成 / 一部達成 / 未達)
  - 目標: (計画時のゴールを再掲)
  - 結果: (達成状況を具体的に記述)
- **完了した主要タスク/成果物:**
  - (完了したタスクリスト No. や主要な成果物を記載)
- **特記事項・次への影響:**
  - (予定外の作業、発生した課題、次のイテレーションへの申し送り事項など)

## イテレーション完了時チェックリスト

- [ ] **技術タスク同期:** イテレーション中に発生/完了した技術タスクは `docs/technical_tasks.md` に反映したか？
- [ ] **ドメイン知識同期:**
  - [ ] 新しい用語や定義、ルールの変更は `docs/domain/ubiquitous-language.md` に反映したか？
  - [ ] ドメインモデルの構造に変更はあったか？ あれば `docs/domain/domain-model.md` に反映したか？
- [ ] **その他ドキュメント同期:**
  - [ ] プロジェクト概要や使い方に変更はあったか？ あれば `README.md` に反映したか？
  - [ ] 開発プロセスやガイドラインに変更はあったか？ あれば関連ドキュメント (`docs/process/`, `docs/PRODUCT_DEVELOPMENT_GUIDE.md` など) に反映したか？
  - [ ] プロダクト定義 (`docs/product/`) や要求定義 (`docs/requirements/`) に影響する変更はなかったか？ (あれば更新 or 次期タスク化)
- [ ] **ADR 同期:** 新たなアーキテクチャ決定は ADR (`docs/architecture/adr/`) として記録したか？
- [ ] **DB スキーマ同期:** (DB 変更があった場合) `docs/db/schema.sql` 及び `docs/db/er-diagram.md` は最新の状態か？ マイグレーションファイルは作成/適用済みか？

## 振り返り (Retrospective)

- **Keep (良かったこと):**
  - [ ]
- **Problem (問題点・課題):**
  - [ ]
- **Try (次に試すこと):**
  - [ ]
- **戦略への示唆 (任意):**
  - [ ] 今回の学びや課題から、プロダクト戦略/ロードマップ (`docs/product/`) の見直しに繋がりそうな点はあったか？ (あれば戦略レビューのインプット候補)
  - [ ] 次回の戦略レビューに向けて、意識的に収集・観察すべきデータやユーザーの声は何か？
