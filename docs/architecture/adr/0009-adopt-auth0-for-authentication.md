# ADR 0009: 認証・認可サービスとして Auth0 を採用

*   **Status**: Accepted
*   **Date**: 2025-04-20
*   **Deciders**: (議論参加者)

## Context and Problem Statement

Webアプリケーションにおいて、ユーザー認証（ユーザーが誰であるかを確認する）および認可（ユーザーが何をする権限を持っているかを確認する）の仕組みが必要である。これを安全かつ効率的に実装するための方法を選定する必要がある。

## Decision Drivers

*   **セキュリティ**: 業界標準のプロトコル (OAuth 2.0, OpenID Connect) を利用し、安全な認証フローを実現すること。
*   **開発効率**: 実装の手間を省き、開発者がアプリケーションのコアロジックに集中できるようにすること。
*   **機能性**: ユーザー登録、ログイン、パスワードリセット、ソーシャルログインなどの基本的な認証機能を提供すること。ロールベースのアクセス制御（RBAC）など、基本的な認可機能もサポートしていること。
*   **コスト**: 無料または低コストで利用できること（サンプルプロジェクトのため）。
*   **エコシステム**: SDKやドキュメントが充実しており、バックエンド (Rust) およびフロントエンド (React/Next.js) との連携が容易であること。

## Considered Options

1.  **Auth0 (by Okta)**: IDaaS (Identity as a Service) プラットフォーム。
    *   Pros: 豊富な機能（ソーシャルログイン、MFA、パスワードレスなど）、高いカスタマイズ性、優れたドキュメントとSDK、無料枠あり、OIDC/OAuth2準拠。
    *   Cons: 機能が多いため、最初はやや複雑に感じる可能性がある。
2.  **Firebase Authentication**: GoogleのBaaSに含まれる認証サービス。
    *   Pros: Firebaseエコシステムとの統合が容易、基本的な認証機能を提供、無料枠あり。
    *   Cons: Auth0ほどの機能やカスタマイズ性はない、特定のプラットフォームに依存する。
3.  **AWS Cognito**: AWSのID管理サービス。
    *   Pros: AWSエコシステムとの統合が深い、スケーラブル。
    *   Cons: 設定が複雑と感じることがある、Auth0ほどの開発者体験を提供しない場合がある。
4.  **自前実装 (ライブラリ利用)**: 例えば、Rustの `jsonwebtoken`, `oauth2`, `openidconnect` クレートや、Next.jsの `next-auth` などを用いて認証・認可を独自に実装する。
    *   Pros: 完全なコントロールが可能、外部サービスへの依存がない。
    *   Cons: 実装・運用・セキュリティ維持のコストが高い、セキュリティリスクを伴う可能性がある。
5.  **Keycloak**: オープンソースのID管理ソリューション。
    *   Pros: オープンソース、オンプレミスでの運用も可能、豊富な機能。
    *   Cons: 自前でのホスティングと運用管理が必要、学習コストが高い可能性がある。
6.  **Okta**: Auth0の親会社。エンタープライズ向けの強力なID管理ソリューション。
    *   Pros: 非常に高機能、エンタープライズレベルのセキュリティと管理機能。
    *   Cons: サンプルプロジェクトにはオーバースペック、コストが高い可能性がある。

## Decision Outcome

**認証・認可サービスとして Auth0 を採用することを選択する。**

理由:
*   **開発効率とセキュリティ**: 認証・認可の複雑な部分をAuth0に任せることで、安全な実装を迅速に行い、開発者はアプリケーション固有の機能開発に集中できる。
*   **機能と柔軟性**: 無料枠でも基本的な認証・認可機能が十分に提供されており、ソーシャルログインなども簡単に導入できる。将来的な機能拡張にも対応しやすい。
*   **エコシステムとドキュメント**: 公式SDKや豊富なドキュメントにより、Rustバックエンド (Actix Web) および Next.js フロントエンドとの連携が比較的容易である。
*   **業界標準**: OAuth 2.0 / OpenID Connect に準拠しており、標準的な認証フローを学ぶ良い機会となる。
*   **コスト**: 無料枠が用意されており、サンプルプロジェクトの範囲では十分である。

## Consequences

### Positive:
*   認証・認可に関する実装・運用コストを大幅に削減できる。
*   高いセキュリティレベルを確保できる。
*   ソーシャルログインなどの機能追加が容易になる。
*   開発者はコア機能の開発に集中できる。

### Negative:
*   外部サービス (Auth0) への依存が発生する。
*   Auth0の仕様変更や障害の影響を受ける可能性がある。
*   無料枠の制限（ユーザー数、機能など）を超える場合は有料プランへの移行が必要になる。

## References

*   ADR 0004: サービス提供形態としてWebアプリケーションを採用
*   ADR 0005: システム構成としてSPA + APIアーキテクチャを採用 