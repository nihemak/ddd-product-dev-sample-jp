# ADR 0008: デプロイプラットフォームとして Render (+ Vercel) を採用

*   **Status**: Accepted
*   **Date**: 2025-04-20
*   **Deciders**: (議論参加者)

## Context and Problem Statement

開発したアプリケーション（バックエンドAPIとフロントエンドSPA）を動作させるためのデプロイプラットフォームを選定する必要がある。開発の容易さ、運用コスト（特に無料枠の有無）、サンプルプロジェクトとしての学習容易性などを考慮する必要がある。インフラ管理の複雑さを避けたいという意向もある。

## Decision Drivers

*   **開発者体験 (DX)**: デプロイや設定が容易であること。
*   **コスト**: 無料または低コストで始められること（サンプルプロジェクトのため）。
*   **機能性**: バックエンドAPI（Rust）、フロントエンドSPA（React/Next.js）、データベース（PostgreSQL）をホストできること。
*   **IaC (Infrastructure as Code)**: 設定をコードで管理できることが望ましい (ただし、必須ではない)。
*   **学習容易性**: 新しい技術に触れる機会として、学習コストが比較的高くないこと。

## Considered Options

1.  **Render**: Webサービス、データベース、バックグラウンドワーカーなどをホストできるPaaS。
    *   Pros: シンプルなUIと設定、多様なサービスタイプをサポート (Rust含む)、PostgreSQLのマネージドサービスを提供、無料枠あり (`render.yaml` によるIaCが可能)、学習コストが比較的低い。
    *   Cons: AWS/GCPほどの機能・柔軟性はない、Terraformプロバイダーはコミュニティ製で非公式、高度なイベント駆動（マネージドMQ等）は提供されていない。
2.  **Vercel**: フロントエンド開発に特化したPaaS。特にNext.jsとの親和性が高い。
    *   Pros: フロントエンドのデプロイが非常に簡単、高パフォーマンスなCDN、無料枠あり、Next.jsとの連携がスムーズ。
    *   Cons: バックエンドやデータベースのホスティングには制約がある（Serverless Functions中心）。
3.  **Fly.io**: DockerコンテナをグローバルにデプロイできるPaaS。
    *   Pros: パフォーマンスが良い、無料枠あり、PostgreSQLもホスト可能。
    *   Cons: Renderより設定項目が多く、やや学習コストが高い可能性。
4.  **AWS (EC2, RDS, S3, etc.)**: 高機能なIaaS/PaaS。
    *   Pros: 非常に高機能で柔軟性が高い、あらゆるユースケースに対応可能。
    *   Cons: 設定・運用が複雑、コスト管理が難しい、無料枠だけでは制限が多い場合がある、学習コストが高い。
5.  **Google Cloud Platform (GCP - Cloud Run, Cloud SQL, etc.)**: AWSと同様に高機能なIaaS/PaaS。
    *   Pros: AWSと同様に高機能、Cloud Runなどサーバーレスオプションが充実。
    *   Cons: AWSと同様に複雑性やコスト、学習コストの問題。
6.  **Firebase**: GoogleのBaaS (Backend as a Service)。
    *   Pros: フロントエンド開発との統合が容易、認証やデータベースなどの機能が揃っている、無料枠あり。
    *   Cons: Rustバックエンドの直接ホストは難しい、特定の技術スタックにロックインされやすい。

## Decision Outcome

**バックエンドAPIとデータベースは Render に、フロントエンドSPAは Vercel にデプロイすることを選択する。**

理由:
*   **シンプルさとコスト効率**: Render はRustバックエンドとPostgreSQLを無料枠から簡単にホストでき、運用がシンプル。Vercel はNext.jsフロントエンドのデプロイとパフォーマンスに最適化されており、こちらも無料枠がある。
*   **適切な関心の分離**: バックエンドとフロントエンドを異なるプラットフォームにデプロイすることで、それぞれの最適化を追求できる。
*   **学習機会**: RenderとVercelはモダンなPaaSであり、AWS/GCPとは異なるアプローチを学ぶ良い機会となる。学習コストも比較的低い。
*   **IaC**: Render は `render.yaml` によるIaCをサポートしており、シンプルに構成管理が可能。
*   **モニタリング**: 両プラットフォームとも基本的なモニタリング機能を提供しており、サンプルプロジェクトには十分。
*   **イベント駆動**: 高度なイベント駆動は現時点では不要と判断。必要になった場合は、RenderのBackground Workerや外部サービス連携、あるいはシンプルな DB ポーリングなどを検討する。

## Consequences

### Positive:
*   バックエンド、データベース、フロントエンドを低コスト（無料枠）で迅速にデプロイできる。
*   インフラ管理のオーバーヘッドが小さい。
*   フロントエンドとバックエンドのデプロイパイプラインを分離できる。
*   モダンなPaaS/Jamstackアーキテクチャを経験できる。

### Negative:
*   AWS/GCPほどの機能やコントロールは得られない。
*   RenderのTerraformサポートは非公式であり、安定性に懸念がある可能性がある。
*   プラットフォーム固有の設定や制約に依存する部分がある。
*   高度なマネージドサービス（MQなど）を利用する場合は外部サービスとの連携が必要。

## References

*   ADR 0004: サービス提供形態としてWebアプリケーションを採用
*   ADR 0005: システム構成としてSPA + APIアーキテクチャを採用
*   ADR 0006: フロントエンド技術として React (TypeScript) + Next.js を採用
*   ADR 0007: データストアとして PostgreSQL を採用 