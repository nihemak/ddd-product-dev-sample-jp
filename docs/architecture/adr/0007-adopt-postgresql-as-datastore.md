# ADR 0007: データストアとして PostgreSQL を採用

*   **Status**: Accepted
*   **Date**: 2025-04-20
*   **Deciders**: (議論参加者)

## Context and Problem Statement

アプリケーションの状態を永続化するためのデータストア技術を選定する必要がある。Webアプリケーション (ADR 0004) を SPA + API アーキテクチャ (ADR 0005) で構築するため、バックエンドAPI (Rust) から利用しやすいデータベースが求められる。主な選択肢としてリレーショナルデータベース (RDB) と NoSQL データベースが考えられる。

## Decision Drivers

*   **開発のしやすさ・エコシステム**: 一般的で、Rust から利用しやすいライブラリが存在すること。
*   **サンプルとしての価値**: 広く使われている技術であり、学習者にとっても有益であること。
*   **機能要件**: トランザクション管理、データの一貫性維持など、ドメインモデルの永続化に適していること。
*   **プラットフォーム互換性**: 選定するデプロイプラットフォームで利用可能であること。

## Considered Options

1.  **PostgreSQL (RDB)**: オープンソースで高機能なリレーショナルデータベース。
    *   Pros: SQL標準への準拠度が高い、豊富な機能（JSONサポート、全文検索等）、成熟した技術、Rustの主要なORM/SQLライブラリ（`sqlx`, `diesel`）が対応、多くのPaaSでマネージドサービスが提供されている。
    *   Cons: スキーマ定義が必要、水平スケーリングがNoSQLに比べて複雑な場合がある。
2.  **MySQL/MariaDB (RDB)**: PostgreSQLと並んで広く使われるRDB。
    *   Pros: PostgreSQLと同様に広く使われている、Rustライブラリも存在する。
    *   Cons: 機能面でPostgreSQLに劣る部分もある（ユースケースによる）。
3.  **SQLite (RDB)**: サーバーレスなファイルベースのRDB。
    *   Pros: セットアップが非常に簡単、ローカル開発やテストに適している。
    *   Cons: 本番環境での同時書き込み性能に限界、マネージドサービスが少ない。
4.  **MongoDB (NoSQL - Document)**: ドキュメント指向データベース。
    *   Pros: スキーマレスで柔軟性が高い、JSONライクなデータ構造と親和性が高い、スケーラビリティが高い。
    *   Cons: トランザクション管理がRDBより複雑な場合がある、データの一貫性維持に注意が必要、Rustライブラリの成熟度がRDB系に比べてやや低い可能性。
5.  **Redis (NoSQL - Key-Value/In-Memory)**: インメモリデータベース。
    *   Pros: 非常に高速。
    *   Cons: 主なデータストアとしては不向き（キャッシュやセッションストア等に適する）。

## Decision Outcome

**選択肢1「PostgreSQL」を採用する。**

理由:
*   **汎用性とエコシステム**: RDBとして広く普及しており、多くの開発者にとって馴染み深い。Rustのエコシステム（`sqlx`, `diesel`）も成熟しており、開発を進めやすい。
*   **サンプルとしての価値**: RDB/SQLの知識は汎用性が高く、学習リソースとしての価値が高い。
*   **機能と信頼性**: トランザクション管理機能が豊富で、データの一貫性を保ちやすく、複雑なドメインモデルを扱うDDDとも相性が良い。
*   **プラットフォーム互換性**: Render をはじめとする多くのPaaSでマネージドサービスとして提供されており、運用しやすい。

## Consequences

### Positive:
*   成熟し安定した技術基盤を利用できる。
*   強力なトランザクション機能によりデータの一貫性を保ちやすい。
*   豊富なドキュメントやコミュニティサポートを活用できる。
*   Rustからの利用が容易。

### Negative:
*   事前にスキーマを定義・管理する必要がある。
*   (今回のスコープでは考えにくいが) 極端な高負荷や水平スケーリング要件にはNoSQLの方が適する場合がある。

## References

*   ADR 0004: サービス提供形態としてWebアプリケーションを採用
*   ADR 0005: システム構成としてSPA + APIアーキテクチャを採用 