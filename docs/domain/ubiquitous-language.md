# 日本語ユビキタス言語集

このドキュメントは、「記念日プレゼント予約・配送サービス」プロジェクト内で使用される主要なドメイン用語、すなわち**日本語のユビキタス言語**を定義します。
`PRODUCT_DEVELOPMENT_GUIDE.md` やコーディング規約にもある通り、ビジネス要求、ドキュメント、コード (`src/domain.rs` など) の間で一貫した日本語の言語を使用することで、コミュニケーションギャップを減らし、ドメイン理解を深めることを目的とします。
英語表記は混乱を避けるため原則として記載しません。

**注意:** 現在、このドキュメントには「記念日プレゼント予約・配送サービス 主要用語」と、初期サンプル実装に由来する用語が混在しています。将来的にはソースコードをリファクタリングし、サンプル由来の用語は削除される予定です。

## 記念日プレゼント予約・配送サービス 主要用語

このセクションでは、`docs/product/` や `docs/requirements/` で定義された、記念日プレゼント予約・配送サービスのドメインに特化した用語を定義します。
アーキテクチャ設計(ADR 0003)に基づき、特に「プレゼント予約」のような状態を持つエンティティについては、実装レベルではその状態に応じた個別の型で表現するアプローチを採用します。

### エンティティ (Entity)

- **プレゼント予約**
  - 説明: 依頼者からの記念日プレゼントの依頼全体を表す中心的な概念。予約ID、依頼者情報、届け先情報、記念日、選択されたプレゼント（手配or発送代行）、メッセージ、ラッピング、配送日時、予約ステータスなどを含む。
  - 実装上の注意: 実装レベルでは、この予約の状態（予約受付済み、発送準備中など）に応じて個別の型（例: `予約受付済みプレゼント予約型`, `発送準備中プレゼント予約型`）で表現されます (詳細は ADR 0003 参照)。これにより、各状態で可能な操作や保持するデータが型レベルで保証されます。
  - 関連ドキュメント: `eventstorming.md` (集約)、`roadmap.md` (エピック)、`user_story_mapping.md` (バックボーン、ストーリー)
- **状態固有の型 (実装詳細)**
    - 説明: 「プレゼント予約」エンティティの状態を実装レベルで表現するための型。ADR 0003 のアプローチに基づき、各状態に対応する。（実際の型名は実装時に決定）
        - `予約受付済みプレゼント予約型`
        - `発送準備中プレゼント予約型`
        - `発送済みプレゼント予約型`
        - `配送完了プレゼント予約型`
        - `キャンセル済みプレゼント予約型`
- **届け先**
  - 説明: プレゼントの届け先の情報（氏名、住所、連絡先、関連する記念日など）を表すエンティティ。依頼者ごとに複数の届け先を管理できる。
  - 関連ドキュメント: `eventstorming.md` (集約)、`roadmap.md` (エピック)
- **ユーザーアカウント**
  - 説明: サービスを利用する依頼者（ユーザー）を表すエンティティ。アカウントID、認証情報（メールアドレス、パスワードハッシュなど）、プロフィール情報を持つ。
  - 関連ドキュメント: `eventstorming.md` (集約)、`roadmap.md` (エピック)
- **商品**
  - 説明: プレゼント手配サービスで提供される商品を表すエンティティ。商品ID、名前、説明、価格、画像などを持つ。
  - 関連ドキュメント: `eventstorming.md` (集約: 商品)、`user_story_mapping.md` (ストーリー)
- **支払い**
  - 説明: プレゼント予約に関連する支払い情報を表すエンティティ。支払いID、予約ID、金額、支払い方法、支払い状態などを持つ。
  - 関連ドキュメント: `eventstorming.md` (集約)

### 値オブジェクト (Value Object)

- **予約ID**
  - 説明: プレゼント予約を一意に識別するID。(UUID v4 を想定)
- **届け先ID**
  - 説明: 届け先エンティティを一意に識別するID。(UUID v4 を想定)
- **ユーザーID**
  - 説明: ユーザーアカウント (依頼者) を一意に識別するID。(UUID v4 を想定)
- **商品ID**
  - 説明: 商品エンティティを一意に識別するID。(UUID v4 を想定)
- **記念日**
  - 説明: プレゼントを贈る対象となる日付 (日付型、例: `chrono::NaiveDate`) と、その名称（例: 誕生日、結婚記念日）。
- **予約ステータス**
  - 説明: プレゼント予約の現在の状態を示す概念。
  - 取りうる値（例）: `予約受付済み`, `発送準備中`, `発送済み`, `配送完了`, `キャンセル済み`
  - 実装上の注意: この概念は、実装レベルでは個別の状態を表す型（例: `予約受付済みプレゼント予約型`）によって具体化されます (ADR 0003)。
  - 関連ドキュメント: `eventstorming.md` (イベント/コマンド)、`user_story_mapping.md` (管理者ストーリー)
- **支払いID**
  - 説明: 支払いエンティティを一意に識別するID。(UUID v4 を想定)
- **メッセージ内容**
  - 説明: メッセージカードに記載されるテキスト。(String型を想定)
- **ラッピングオプション**
  - 説明: 選択されたラッピングの種類。(Enum または String 型を想定)
- **配送希望日時**
  - 説明: 依頼者が希望する配送の日時。(日時型、例: `chrono::DateTime<Utc>` を想定)
- **金額**
  - 説明: 商品代金やサービス料金を表す。(非負整数型、例: `u32` または専用の金額型を想定。通貨情報は別途考慮)
- **支払い状態**
  - 説明: 支払いが完了しているかなどの状態を示す。(Enum 型を想定。例: `支払い状態::未払い`)

### ドメインイベント (Domain Event)

- **プレゼント予約受け付け完了**
  - 説明: 顧客からのプレゼント予約がシステムに受け付けられたことを示すイベント。
  - 関連ドキュメント: `eventstorming.md` (イベント: プレゼント発送代行が予約された, プレゼント手配が予約された)
- **届け先登録完了**
   - 説明: 新しい届け先が登録されたことを示すイベント。
   - 関連ドキュメント: `eventstorming.md` (イベント: 届け先が登録された)
- **予約発送準備開始**
   - 説明: 予約されたプレゼントの発送準備が開始されたことを示すイベント。
   - 関連ドキュメント: `eventstorming.md` (イベント: プレゼント発送準備中にされた)
- **予約発送完了**
   - 説明: 予約されたプレゼントが発送されたことを示すイベント。
   - 関連ドキュメント: `eventstorming.md` (イベント: プレゼントが発送された)
- **予約配送完了**
   - 説明: 予約されたプレゼントが届け先に配送完了したことを示すイベント。（外部システムからの連携が必要な場合あり）
   - 関連ドキュメント: `eventstorming.md` (イベント: プレゼント配送が完了した)
- **予約キャンセル完了**
   - 説明: 予約がキャンセルされたことを示すイベント。
   - 関連ドキュメント: `eventstorming.md` (イベント: 予約がキャンセルされた)
- **支払い完了**
   - 説明: 予約に関連する支払いが完了したことを示すイベント。
   - 関連ドキュメント: `eventstorming.md` (イベント: 支払いが行われた)
- **記念日リマインダー対象確定**
   - 説明: 記念日が近づき、リマインダー通知の送信対象となったことを示すイベント。
   - 関連ドキュメント: `eventstorming.md` (イベント: 記念日が近づいた)

### ドメインサービス / ロジック関数 (Domain Logic / Service)

- **予約を作成する**
  - 説明: 依頼者からの情報に基づき、新しい `予約受付済みプレゼント予約型` を作成します。発送代行か手配かで初期状態や必要な情報が異なる可能性があります。
  - 関連ドキュメント: `eventstorming.md` (コマンド: 発送代行を依頼する, プレゼント手配を依頼する)
- **予約内容を変更する**
  - 説明: 特定の状態（例: `予約受付済みプレゼント予約型`）の予約内容（メッセージ、配送日時など）を変更します。変更可能な状態や条件のチェックを含みます。
  - 関連ドキュメント: `eventstorming.md` (コマンド: 予約を変更する)
- **予約をキャンセルする**
  - 説明: 特定の状態（例: `予約受付済みプレゼント予約型`, `発送準備中プレゼント予約型`）の予約をキャンセルし、`キャンセル済みプレゼント予約型` に遷移させます。キャンセル可能な条件のチェックを含みます。
  - 関連ドキュメント: `eventstorming.md` (コマンド: 予約をキャンセルする)
- **発送準備を開始する**
  - 説明: `予約受付済みプレゼント予約型` を受け取り、`発送準備中プレゼント予約型` に遷移させます。管理者が行う操作。
  - 関連ドキュメント: `eventstorming.md` (コマンド: プレゼント発送準備中にする)
- **発送を完了する**
  - 説明: `発送準備中プレゼント予約型` を受け取り、`発送済みプレゼント予約型` に遷移させます。管理者が行う操作。
  - 関連ドキュメント: `eventstorming.md` (コマンド: プレゼントを発送する)
- **配送完了を記録する**
  - 説明: `発送済みプレゼント予約型` を受け取り、`配送完了プレゼント予約型` に遷移させます。外部システムからの通知を受けて実行される場合もあります。

### リポジトリインターフェース (Repository Interface)

- **プレゼント予約リポジトリ**
  - 説明: プレゼント予約エンティティ（状態に応じた型を含む）の永続化（保存、検索、更新）操作を定義するインターフェース（トレイト）。
- **届け先リポジトリ**
  - 説明: 届け先エンティティの永続化操作を定義するインターフェース（トレイト）。
- **ユーザーアカウントリポジトリ**
  - 説明: ユーザーアカウントエンティティの永続化操作を定義するインターフェース（トレイト）。
- **商品リポジトリ**
  - 説明: 商品エンティティの検索操作を定義するインターフェース（トレイト）。
- **支払いリポジトリ**
  - 説明: 支払いエンティティの永続化操作を定義するインターフェース（トレイト）。


### その他

- **発送代行**
  - 説明: 依頼者が用意したプレゼントを、指定された届け先に発送するサービス形態。
- **プレゼント手配**
  - 説明: システムが提供する商品カタログから依頼者が選択した商品を、プレゼントとして手配・発送するサービス形態。
- **リマインダー**
  - 説明: 登録された記念日が近づいていることを依頼者に通知する機能。
- **通知**
  - 説明: 予約のステータス変更（発送準備開始、発送完了など）やリマインダーを依頼者に知らせる機能・仕組み。

---

## サンプル実装由来の用語 (既存コードとの対応用)

以下の用語は、初期のサンプル実装 (`src/`) に基づくものです。
注意: これらは現在の記念日プレゼント予約・配送サービスのドメインモデルとは直接対応しない可能性があります。将来的には上記の「記念日プレゼント予約・配送サービス 主要用語」に合わせてソースコードがリファクタリングされ、以下の定義は削除される予定です。

### エンティティ (Entity)

- **注文**
  - 説明: 顧客からの商品の注文を表すエンティティ。注文ID、商品リスト、合計金額、注文状態を持つ。
  - 対応コード: `struct 注文`
- **商品**
  - 説明: 販売される商品を表すエンティティ。商品ID、名前、価格を持つ。
  - 対応コード: `struct 商品`

### 値オブジェクト (Value Object)

- **注文ID**
  - 説明: 注文を一意に識別するID。UUIDに基づいています。
  - 対応コード: `struct 注文ID(Uuid)`
- **商品ID**
  - 説明: 商品を一意に識別するID。UUIDに基づいています。
  - 対応コード: `struct 商品ID(Uuid)`
- **注文状態**
  - 説明: 注文が現在どの段階にあるかを示す状態。
  - 取りうる値:
    - `受付済み`
    - `発送準備中`
    - `発送済み`
    - `キャンセル済み`
  - 対応コード: `enum 注文状態`

### ドメインサービス / ロジック関数 (Domain Logic)

- **合計金額計算**
  - 説明: 商品IDリストと価格取得関数を受け取り、注文の合計金額を計算する。
  - 対応コード: `fn 合計金額計算`
- **注文作成**
  - 説明: 商品IDリストと価格取得関数を受け取り、新しい注文エンティティを作成する（状態は「受付済み」）。
  - 対応コード: `fn 注文作成`
- **発送準備中へ変更**
  - 説明: 注文の状態を「受付済み」から「発送準備中」へ変更する。
  - 対応コード: `fn 発送準備中へ変更`
- **発送済みへ変更**
  - 説明: 注文の状態を「発送準備中」から「発送済み」へ変更する。
  - 対応コード: `fn 発送済みへ変更`
- **注文キャンセル**
  - 説明: 注文の状態を「キャンセル済み」に変更する（発送済みでなければ）。
  - 対応コード: `fn 注文キャンセル`

### ドメインエラー (Domain Error)

- **DomainError**
  - 説明: ドメインルール違反や不整合が発生した場合のエラー。
  - 対応コード: `enum DomainError`
  - バリアント:
    - `注文商品空エラー`
    - `不正な状態遷移エラー`
    - `注文NotFound`
    - `商品NotFound`
    - `価格計算オーバーフロー`

### リポジトリインターフェース (Repository Interface)

- **注文Repository**
  - 説明: 注文エンティティの永続化（保存、検索）操作を定義するインターフェース（トレイト）。
  - 対応コード: `trait 注文Repository`
- **商品Repository**
  - 説明: 商品エンティティの検索操作を定義するインターフェース（トレイト）。
  - 対応コード: `trait 商品Repository`

### アプリケーション層の用語 (Application Layer Terms)

- **注文サービス**
  - 説明: 注文に関するユースケース（注文受付、発送準備など）を実装するサービスクラス。ドメインオブジェクトやリポジトリを操作する。
  - 対応コード: `struct 注文サービス`
- **ApplicationError**
  - 説明: アプリケーション層で発生するエラー（ドメインエラーのラップ、リポジトリエラーなど）。
  - 対応コード: `enum ApplicationError`
