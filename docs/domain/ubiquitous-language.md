# ユビキタス言語集

このドキュメントは、プロジェクト内で使用される主要なドメイン用語（ユビキタス言語）を定義します。
ビジネス要求、ドキュメント、コード (`src/domain.rs` など) の間で一貫した言語を使用することで、コミュニケーションギャップを減らし、ドメイン理解を深めることを目的とします。

**注意:** 現在、このドキュメントには「記念日プレゼントサービス 主要用語」と、初期サンプル実装に由来する用語が混在しています。将来的にはソースコードをリファクタリングし、サンプル由来の用語は削除される予定です。

## 記念日プレゼントサービス 主要用語

このセクションでは、`docs/product/` や `docs/requirements/` で定義された、記念日プレゼント予約・配送サービスのドメインに特化した用語を定義します。

### エンティティ (Entity)

- **プレゼント予約 (Present Reservation)**
  - 説明: 依頼者からの記念日プレゼントの依頼全体を表す中心的なエンティティ。予約ID、依頼者情報、届け先情報、記念日、選択されたプレゼント（手配or発送代行）、メッセージ、ラッピング、配送日時、予約ステータスなどを含む。
  - 関連ドキュメント: `eventstorming.md` (集約)、`roadmap.md` (エピック)、`user_story_mapping.md` (バックボーン、ストーリー)
- **届け先 (Recipient / Destination)**
  - 説明: プレゼントの届け先の情報（氏名、住所、連絡先、関連する記念日など）を表すエンティティ。依頼者ごとに複数の届け先を管理できる。
  - 関連ドキュメント: `eventstorming.md` (集約)、`roadmap.md` (エピック)
- **ユーザーアカウント (User Account)**
  - 説明: サービスを利用する依頼者（ユーザー）を表すエンティティ。アカウントID、認証情報（メールアドレス、パスワードハッシュなど）、プロフィール情報を持つ。
  - 関連ドキュメント: `eventstorming.md` (集約)、`roadmap.md` (エピック)
- **商品 (Product / Catalog Item)**
  - 説明: プレゼント手配サービスで提供される商品を表すエンティティ。商品ID、名前、説明、価格、画像などを持つ。
  - 関連ドキュメント: `eventstorming.md` (集約: 商品)、`user_story_mapping.md` (ストーリー)
- **支払い (Payment)**
  - 説明: プレゼント予約に関連する支払い情報を表すエンティティ。支払いID、予約ID、金額、支払い方法、支払い状態などを持つ。
  - 関連ドキュメント: `eventstorming.md` (集約)

### 値オブジェクト (Value Object)

- **予約ID (Reservation ID)**
  - 説明: プレゼント予約を一意に識別するID。
- **届け先ID (Recipient ID)**
  - 説明: 届け先を一意に識別するID。
- **ユーザーID (User ID)**
  - 説明: ユーザーアカウントを一意に識別するID。
- **商品ID (Product ID)**
  - 説明: 商品を一意に識別するID。
- **記念日 (Anniversary)**
  - 説明: プレゼントを贈る対象となる日付と、その名称（例: 誕生日、結婚記念日）。
- **予約ステータス (Reservation Status)**
  - 説明: プレゼント予約の現在の状態を示す。
  - 取りうる値（例）: `予約受付済み (Reserved)`, `発送準備中 (Preparing)`, `発送済み (Shipped)`, `配送完了 (Delivered)`, `キャンセル済み (Cancelled)`
  - 関連ドキュメント: `eventstorming.md` (イベント/コマンド)、`user_story_mapping.md` (管理者ストーリー)
- **メッセージ内容 (Message Content)**
   - 説明: メッセージカードに記載されるテキスト。
- **ラッピングオプション (Wrapping Option)**
   - 説明: 選択されたラッピングの種類。
- **配送希望日時 (Desired Delivery Date and Time)**
   - 説明: 依頼者が希望する配送の日時。
- **金額 (Amount / Price)**
   - 説明: 商品代金やサービス料金を表す。通貨も含む。
- **支払い状態 (Payment Status)**
   - 説明: 支払いが完了しているかなどの状態を示す。（例: 未払い, 支払い済み, 失敗）

### ドメインイベント (Domain Event)

- **プレゼント予約受け付け完了 (PresentReservationReceived)**
  - 説明: 顧客からのプレゼント予約がシステムに受け付けられたことを示すイベント。
  - 関連ドキュメント: `eventstorming.md` (イベント: プレゼント発送代行が予約された, プレゼント手配が予約された)
- **届け先登録完了 (RecipientRegistered)**
   - 説明: 新しい届け先が登録されたことを示すイベント。
   - 関連ドキュメント: `eventstorming.md` (イベント: 届け先が登録された)
- **予約発送準備開始 (ReservationPreparationStarted)**
   - 説明: 予約されたプレゼントの発送準備が開始されたことを示すイベント。
   - 関連ドキュメント: `eventstorming.md` (イベント: プレゼント発送準備中にされた)
- **予約発送完了 (ReservationShipped)**
   - 説明: 予約されたプレゼントが発送されたことを示すイベント。
   - 関連ドキュメント: `eventstorming.md` (イベント: プレゼントが発送された)
- **予約配送完了 (ReservationDelivered)**
   - 説明: 予約されたプレゼントが届け先に配送完了したことを示すイベント。（外部システムからの連携が必要な場合あり）
   - 関連ドキュメント: `eventstorming.md` (イベント: プレゼント配送が完了した)
- **予約キャンセル完了 (ReservationCancelled)**
   - 説明: 予約がキャンセルされたことを示すイベント。
   - 関連ドキュメント: `eventstorming.md` (イベント: 予約がキャンセルされた)
- **支払い完了 (PaymentCompleted)**
   - 説明: 予約に関連する支払いが完了したことを示すイベント。
   - 関連ドキュメント: `eventstorming.md` (イベント: 支払いが行われた)
- **記念日リマインダー対象確定 (AnniversaryReminderTargetDetermined)**
   - 説明: 記念日が近づき、リマインダー通知の送信対象となったことを示すイベント。
   - 関連ドキュメント: `eventstorming.md` (イベント: 記念日が近づいた)

### ドメインサービス / ロジック関数 (Domain Logic / Service)

- **予約を作成する (Create Reservation)**
  - 説明: 依頼者からの情報に基づき、新しいプレゼント予約エンティティを作成する。発送代行か手配かで初期状態や必要な情報が異なる可能性がある。予約ステータスは「予約受付済み」となる。
  - 関連ドキュメント: `eventstorming.md` (コマンド: 発送代行を依頼する, プレゼント手配を依頼する)
- **予約内容を変更する (Modify Reservation)**
  - 説明: 既存のプレゼント予約の内容（メッセージ、配送日時など）を変更する。変更可能な条件（例: 発送準備前まで）のチェックを含む。
  - 関連ドキュメント: `eventstorming.md` (コマンド: 予約を変更する)
- **予約をキャンセルする (Cancel Reservation)**
  - 説明: 既存のプレゼント予約をキャンセルする。キャンセル可能な条件（例: 発送前まで）のチェックを含む。予約ステータスは「キャンセル済み」となる。
  - 関連ドキュメント: `eventstorming.md` (コマンド: 予約をキャンセルする)
- **発送準備を開始する (Start Preparation)**
  - 説明: 予約ステータスを「発送準備中」に変更する。管理者が行う操作。
  - 関連ドキュメント: `eventstorming.md` (コマンド: プレゼント発送準備中にする)
- **発送を完了する (Complete Shipment)**
  - 説明: 予約ステータスを「発送済み」に変更する。管理者が行う操作。
  - 関連ドキュメント: `eventstorming.md` (コマンド: プレゼントを発送する)
- **配送完了を記録する (Record Delivery)**
  - 説明: 予約ステータスを「配送完了」に変更する。外部システムからの通知を受けて実行される場合もある。

### リポジトリインターフェース (Repository Interface)

- **プレゼント予約リポジトリ (PresentReservationRepository)**
  - 説明: プレゼント予約エンティティの永続化（保存、検索、更新）操作を定義するインターフェース（トレイト）。
- **届け先リポジトリ (RecipientRepository)**
  - 説明: 届け先エンティティの永続化操作を定義するインターフェース（トレイト）。
- **ユーザーアカウントリポジトリ (UserAccountRepository)**
  - 説明: ユーザーアカウントエンティティの永続化操作を定義するインターフェース（トレイト）。
- **商品リポジトリ (ProductRepository)**
  - 説明: 商品エンティティの検索操作を定義するインターフェース（トレイト）。
- **支払いリポジトリ (PaymentRepository)**
  - 説明: 支払いエンティティの永続化操作を定義するインターフェース（トレイト）。


### その他

- **発送代行 (Shipping Proxy / Dispatch Service)**
  - 説明: 依頼者が用意したプレゼントを、指定された届け先に発送するサービス形態。
- **プレゼント手配 (Gift Arrangement / Procurement Service)**
  - 説明: システムが提供する商品カタログから依頼者が選択した商品を、プレゼントとして手配・発送するサービス形態。
- **リマインダー (Reminder)**
  - 説明: 登録された記念日が近づいていることを依頼者に通知する機能。
- **通知 (Notification)**
  - 説明: 予約のステータス変更（発送準備開始、発送完了など）やリマインダーを依頼者に知らせる機能・仕組み。

---

## サンプル実装由来の用語 (既存コードとの対応用)

以下の用語は、初期のサンプル実装 (`src/`) に基づくものです。
**注意:** これらは現在の記念日プレゼントサービスのドメインモデルとは直接対応しない可能性があります。将来的には上記の「記念日プレゼントサービス 主要用語」に合わせてソースコードがリファクタリングされ、以下の定義は削除される予定です。

### エンティティ (Entity)

- **注文 (Order)**
  - 説明: 顧客からの商品の注文を表すエンティティ。注文ID、商品リスト、合計金額、注文状態を持つ。
  - 対応コード: `struct 注文`
- **商品 (Item)**
  - 説明: 販売される商品を表すエンティティ。商品ID、名前、価格を持つ。
  - 対応コード: `struct 商品`

### 値オブジェクト (Value Object)

- **注文ID (OrderID)**
  - 説明: 注文を一意に識別するID。UUIDに基づいています。
  - 対応コード: `struct 注文ID(Uuid)`
- **商品ID (ItemID)**
  - 説明: 商品を一意に識別するID。UUIDに基づいています。
  - 対応コード: `struct 商品ID(Uuid)`
- **注文状態 (OrderStatus)**
  - 説明: 注文が現在どの段階にあるかを示す状態。
  - 取りうる値:
    - `受付済み (Received)`
    - `発送準備中 (Preparing)`
    - `発送済み (Shipped)`
    - `キャンセル済み (Cancelled)`
  - 対応コード: `enum 注文状態`

### ドメインサービス / ロジック関数 (Domain Logic)

- **合計金額計算 (calculate_total_price)**
  - 説明: 商品IDリストと価格取得関数を受け取り、注文の合計金額を計算する。
  - 対応コード: `fn 合計金額計算`
- **注文作成 (create_order)**
  - 説明: 商品IDリストと価格取得関数を受け取り、新しい注文エンティティを作成する（状態は「受付済み」）。
  - 対応コード: `fn 注文作成`
- **発送準備中へ変更 (mark_as_preparing)**
  - 説明: 注文の状態を「受付済み」から「発送準備中」へ変更する。
  - 対応コード: `fn 発送準備中へ変更`
- **発送済みへ変更 (mark_as_shipped)**
  - 説明: 注文の状態を「発送準備中」から「発送済み」へ変更する。
  - 対応コード: `fn 発送済みへ変更`
- **注文キャンセル (cancel_order)**
  - 説明: 注文の状態を「キャンセル済み」に変更する（発送済みでなければ）。
  - 対応コード: `fn 注文キャンセル`

### ドメインエラー (Domain Error)

- **DomainError**
  - 説明: ドメインルール違反や不整合が発生した場合のエラー。
  - 対応コード: `enum DomainError`
  - バリアント:
    - `注文商品空エラー (OrderHasNoItems)`: 注文に商品が一つも含まれていない。
    - `不正な状態遷移エラー (InvalidStateTransition)`: 許可されていない状態遷移を行おうとした。
    - `注文NotFound (OrderNotFound)`: 指定された注文IDの注文が見つからない。
    - `商品NotFound (ItemNotFound)`: 指定された商品IDの商品が見つからない。
    - `価格計算オーバーフロー (PriceCalculationOverflow)`: 合計金額計算中にオーバーフローが発生した。

### リポジトリインターフェース (Repository Interface)

- **注文Repository (OrderRepository)**
  - 説明: 注文エンティティの永続化（保存、検索）操作を定義するインターフェース（トレイト）。
  - 対応コード: `trait 注文Repository`
- **商品Repository (ItemRepository)**
  - 説明: 商品エンティティの検索操作を定義するインターフェース（トレイト）。
  - 対応コード: `trait 商品Repository`

### アプリケーション層の用語 (Application Layer Terms)

- **注文サービス (OrderService)**
  - 説明: 注文に関するユースケース（注文受付、発送準備など）を実装するサービスクラス。ドメインオブジェクトやリポジトリを操作する。
  - 対応コード: `struct 注文サービス`
- **ApplicationError**
  - 説明: アプリケーション層で発生するエラー（ドメインエラーのラップ、リポジトリエラーなど）。
  - 対応コード: `enum ApplicationError`
