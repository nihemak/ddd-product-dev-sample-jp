# 日本語ユビキタス言語集

このドキュメントは、「記念日プレゼント予約・配送サービス」プロジェクト内で使用される主要なドメイン用語、すなわち**日本語のユビキタス言語**を定義します。
`PRODUCT_DEVELOPMENT_GUIDE.md` やコーディング規約にもある通り、ビジネス要求、ドキュメント、コード (`src/domain.rs` など) の間で一貫した日本語の言語を使用することで、コミュニケーションギャップを減らし、ドメイン理解を深めることを目的とします。
英語表記は混乱を避けるため原則として記載しません。

**注意:** 現在、このドキュメントには「記念日プレゼント予約・配送サービス 主要用語」と、初期サンプル実装に由来する用語が混在しています。将来的にはソースコードをリファクタリングし、サンプル由来の用語は削除される予定です。

## 記念日プレゼント予約・配送サービス 主要用語

このセクションでは、`docs/product/` や `docs/requirements/` で定義された、記念日プレゼント予約・配送サービスのドメインに特化した用語を定義します。
アーキテクチャ設計(ADR 0003)に基づき、特に「プレゼント予約」のような状態を持つエンティティについては、実装レベルではその状態に応じた個別の型で表現するアプローチを採用します。

### エンティティ (Entity)

- **プレゼント予約**
  - 説明: 依頼者からの記念日プレゼントの依頼全体を表す中心的な概念。予約ID、依頼者情報、届け先情報、記念日、選択されたプレゼント（手配or発送代行）、メッセージ、ラッピング、配送日時、予約ステータスなどを含む。
  - 実装上の注意: 実装レベルでは、この予約の状態（予約受付済み、発送準備中など）に応じて個別の型（例: `予約受付済みプレゼント予約型`, `発送準備中プレゼント予約型`）で表現されます (詳細は ADR 0003 参照)。これにより、各状態で可能な操作や保持するデータが型レベルで保証されます。
  - 関連ドキュメント: `eventstorming.md` (集約)、`roadmap.md` (エピック)、`user_story_mapping.md` (バックボーン、ストーリー)
- **状態固有の型 (実装詳細)**
    - 説明: 「プレゼント予約」エンティティの状態を実装レベルで表現するための型。ADR 0003 のアプローチに基づき、各状態に対応する。（実際の型名は実装時に決定）
        - `予約受付済みプレゼント予約型`
        - `発送準備中プレゼント予約型`
        - `発送済みプレゼント予約型`
        - `配送完了プレゼント予約型`
        - `キャンセル済みプレゼント予約型`
- **届け先**
  - 説明: プレゼントの届け先の情報（氏名、住所、連絡先など）を表すエンティティ。依頼者ごとに複数の届け先を管理できる。
  - 関連ドキュメント: `eventstorming.md` (集約)、`roadmap.md` (エピック)
- **ユーザーアカウント**
  - 説明: サービスを利用する依頼者（ユーザー）を表すエンティティ。アカウントID、認証情報（メールアドレス、パスワードハッシュなど）、プロフィール情報を持つ。
  - 関連ドキュメント: `eventstorming.md` (集約)、`roadmap.md` (エピック)
- **商品**
  - 説明: プレゼント手配サービスで提供される商品を表すエンティティ。商品ID、名前、説明、価格、画像などを持つ。
  - 関連ドキュメント: `eventstorming.md` (集約: 商品)、`user_story_mapping.md` (ストーリー)
- **支払い**
  - 説明: プレゼント予約に関連する支払い情報を表すエンティティ。支払いID、予約ID、金額、支払い方法、支払い状態などを持つ。
  - 関連ドキュメント: `eventstorming.md` (集約)

### 値オブジェクト (Value Object)

- **予約ID**
  - 説明: プレゼント予約を一意に識別するID。(UUID v4)
- **届け先ID**
  - 説明: 届け先エンティティを一意に識別するID。(UUID v4)
- **依頼者ID (ユーザーID)**
  - 説明: ユーザーアカウント (依頼者) を一意に識別するID。(UUID v4)
- **商品ID**
  - 説明: 商品エンティティを一意に識別するID。(UUID v4)。プレゼント手配の場合に使用される。
- **記念日**
  - 説明: プレゼントを贈る対象となる日付。(日付型、例: `chrono::NaiveDate`)。記念日の名称は別途管理されるか、届け先情報などに含まれる可能性がある。
  - 制約: **指定可能な日付は、予約日から一定の発送リードタイムを経過した未来日である必要がある。**
- **予約ステータス (概念)**
  - 説明: プレゼント予約の現在の状態を示す概念。実装レベルでは個別の状態を表す型で表現される。
  - 取りうる値（例）: `予約受付済み`, `発送準備中`, `発送済み`, `配送完了`, `キャンセル済み`
  - 関連ドキュメント: `eventstorming.md` (イベント/コマンド)、`user_story_mapping.md` (管理者ストーリー)
- **支払いID**
  - 説明: 支払いエンティティを一意に識別するID。(UUID v4)
- **メッセージ内容**
  - 説明: メッセージカードに記載されるテキスト。(String / Text型)
  - 制約: **最大文字数は200文字とする。**
- **ラッピングオプション**
  - 説明: 選択されたラッピングの種類。(Enum または String / Text 型)
- **配送希望日時**
  - 説明: 依頼者が希望する配送の日時。(日時型、例: `chrono::DateTime<Utc>` または `Timestamp with Time Zone`)
- **合計金額**
  - 説明: 商品代金やサービス料金の合計を表す。(非負整数型、例: `u32` または `Decimal`/`Numeric` 型。通貨情報は別途考慮)
- **支払い状態**
  - 説明: 支払いが完了しているかなどの状態を示す。(Enum 型または String / Text 型。例: `支払い状態::未払い`)
- **発送代行プレゼント情報**
    - 説明: ユーザーが用意する発送代行対象プレゼントの内容を示すテキスト情報。品名や特徴など、運営側がプレゼントを識別し取り扱うために必要な情報を記述する。(MVPではテキスト入力のみ)

### ドメインイベント (Domain Event)

- **プレゼント予約受け付け完了**
  - 説明: 顧客からのプレゼント予約がシステムに受け付けられたことを示すイベント。
  - 関連ドキュメント: `eventstorming.md` (イベント: プレゼント発送代行が予約された, プレゼント手配が予約された)
- **届け先登録完了**
   - 説明: 新しい届け先が登録されたことを示すイベント。
   - 関連ドキュメント: `eventstorming.md` (イベント: 届け先が登録された)
- **予約発送準備開始**
   - 説明: 予約されたプレゼントの発送準備が開始されたことを示すイベント。
   - 関連ドキュメント: `eventstorming.md` (イベント: プレゼント発送準備中にされた)
- **予約発送完了**
   - 説明: 予約されたプレゼントが発送されたことを示すイベント。
   - 関連ドキュメント: `eventstorming.md` (イベント: プレゼントが発送された)
- **予約配送完了**
   - 説明: 予約されたプレゼントが届け先に配送完了したことを示すイベント。（外部システムからの連携が必要な場合あり）
   - 関連ドキュメント: `eventstorming.md` (イベント: プレゼント配送が完了した)
- **予約キャンセル完了**
   - 説明: 予約がキャンセルされたことを示すイベント。
   - 関連ドキュメント: `eventstorming.md` (イベント: 予約がキャンセルされた)
- **支払い完了**
   - 説明: 予約に関連する支払いが完了したことを示すイベント。
   - 関連ドキュメント: `eventstorming.md` (イベント: 支払いが行われた)
- **記念日リマインダー対象確定**
   - 説明: 記念日が近づき、リマインダー通知の送信対象となったことを示すイベント。
   - 関連ドキュメント: `eventstorming.md` (イベント: 記念日が近づいた)

### ドメインサービス / ロジック関数 (Domain Logic / Service)

- **予約を作成する**
  - 説明: 依頼者からの情報に基づき、新しい `予約受付済みプレゼント予約型` を作成します。発送代行か手配かで初期状態や必要な情報が異なる可能性があります。**記念日が指定可能な日付（発送リードタイム考慮済み）であるか検証する。**
  - 関連ドキュメント: `eventstorming.md` (コマンド: 発送代行を依頼する, プレゼント手配を依頼する)
- **予約内容を変更する**
  - 説明: 特定の状態（例: `予約受付済みプレゼント予約型`）の予約内容（メッセージ、配送日時など）を変更します。変更可能な状態や条件のチェックを含みます。
  - 関連ドキュメント: `eventstorming.md` (コマンド: 予約を変更する)
- **予約をキャンセルする**
  - 説明: 特定の状態（例: `予約受付済みプレゼント予約型`, `発送準備中プレゼント予約型`）の予約をキャンセルし、`キャンセル済みプレゼント予約型` に遷移させます。キャンセル可能な条件のチェックを含みます。
  - 関連ドキュメント: `eventstorming.md` (コマンド: 予約をキャンセルする)
- **発送準備を開始する**
  - 説明: `予約受付済みプレゼント予約型` を受け取り、`発送準備中プレゼント予約型` に遷移させます。管理者が行う操作。
  - 関連ドキュメント: `eventstorming.md` (コマンド: プレゼント発送準備中にする)
- **発送を完了する**
  - 説明: `発送準備中プレゼント予約型` を受け取り、`発送済みプレゼント予約型` に遷移させます。管理者が行う操作。
  - 関連ドキュメント: `eventstorming.md` (コマンド: プレゼントを発送する)
- **配送完了を記録する**
  - 説明: `発送済みプレゼント予約型` を受け取り、`配送完了プレゼント予約型` に遷移させます。外部システムからの通知を受けて実行される場合もあります。

### リポジトリインターフェース (Repository Interface)

- **プレゼント予約リポジトリ**
  - 説明: プレゼント予約エンティティ（状態に応じた型を含む）の永続化（保存、検索、更新）操作を定義するインターフェース（トレイト）。
- **届け先リポジトリ**
  - 説明: 届け先エンティティの永続化操作を定義するインターフェース（トレイト）。
- **ユーザーアカウントリポジトリ**
  - 説明: ユーザーアカウントエンティティの永続化操作を定義するインターフェース（トレイト）。
- **商品リポジトリ**
  - 説明: 商品エンティティの検索操作を定義するインターフェース（トレイト）。
- **支払いリポジトリ**
  - 説明: 支払いエンティティの永続化操作を定義するインターフェース（トレイト）。


### その他

- **発送代行**
  - 説明: 依頼者が用意したプレゼントを、指定された届け先に発送するサービス形態。この場合、予約にはプレゼントそのものの詳細情報（品名、サイズ、画像など）が含まれる可能性がある。
- **プレゼント手配**
  - 説明: システムが提供する商品カタログから依頼者が選択した商品を、プレゼントとして手配・発送するサービス形態。この場合、予約には選択された `商品ID` のリストが含まれる。
- **リマインダー**
  - 説明: 登録された記念日が近づいていることを依頼者に通知する機能。
- **通知**
  - 説明: 予約のステータス変更（発送準備開始、発送完了など）やリマインダーを依頼者に知らせる機能・仕組み。
- **発送リードタイム**
  - 説明: プレゼントの発送準備と配送に必要な日数。記念日を指定する際の制約条件となる（例: 予約日から N 日後以降）。MVPでは仮に10日とする。
