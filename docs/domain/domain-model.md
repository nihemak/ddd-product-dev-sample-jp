# ドメインモデル図

このドキュメントは、プロジェクトのドメインモデルを Mermaid のクラス図を用いて視覚的に表現します。
ユビキタス言語に基づき、主要なエンティティ、値オブジェクト、およびそれらの関係性を示します。

**注意:** 現在、このドキュメントには「記念日プレゼントサービス」のドメインモデル図と、初期サンプル実装に由来するドメインモデル図が混在しています。将来的にはソースコードのリファクタリングに伴い、サンプル由来のモデル図は削除される予定です。

## 記念日プレゼントサービス ドメインモデル図

```mermaid
classDiagram
    class プレゼント予約 {
        <<Aggregate Root>>
        +予約ID
        +ユーザーID 依頼者ID
        +届け先ID
        +記念日
        +メッセージ内容
        +ラッピングオプション
        +配送希望日時
        +予約ステータス 状態
        +List<商品ID> 商品リスト (手配の場合)
        +String 発送代行プレゼント情報
        +金額 合計金額
        +支払いID
        +予約内容を変更する()
        +予約をキャンセルする()
        +発送準備を開始する()
        +発送を完了する()
        +配送完了を記録する()
    }
    class 届け先 {
        +届け先ID
        +ユーザーID
        +String 氏名
        +String 住所
        +String 連絡先
        +List<記念日> 関連記念日
    }
    class ユーザーアカウント {
        +ユーザーID
        +String メールアドレス
        +String パスワードハッシュ
        +String プロフィール情報
    }
    class 商品 {
        +商品ID
        +String 名前
        +String 説明
        +金額 価格
    }
    class 支払い {
        +支払いID
        +予約ID
        +金額 金額
        +String 支払い方法
        +支払い状態 状態
    }

    class 予約ID { <<ValueObject>> }
    class 届け先ID { <<ValueObject>> }
    class ユーザーID { <<ValueObject>> }
    class 商品ID { <<ValueObject>> }
    class 支払いID { <<ValueObject>> }
    class 記念日 { <<ValueObject>> }
    class 予約ステータス {
      <<Enumeration>>
      予約受付済み
      発送準備中
      発送済み
      配送完了
      キャンセル済み
    }
    class メッセージ内容 { <<ValueObject>> }
    class ラッピングオプション { <<ValueObject>> }
    class 配送希望日時 { <<ValueObject>> }
    class 金額 { <<ValueObject>> }
    class 支払い状態 {
      <<Enumeration>>
      未払い
      支払い済み
      失敗
    }

    プレゼント予約 "1" *-- "1" 予約ID : id
    プレゼント予約 "1" -- "1" ユーザーID : 依頼者
    プレゼント予約 "1" -- "1" 届け先ID : 届け先
    プレゼント予約 "1" -- "1" 記念日 : 記念日
    プレゼント予約 "1" -- "1" 予約ステータス : 状態
    プレゼント予約 "0..*" -- "0..*" 商品ID : 商品リスト
    プレゼント予約 "1" -- "1" 支払いID : 支払い

    ユーザーアカウント "1" *-- "1" ユーザーID : id
    ユーザーアカウント "1" -- "0..*" 届け先 : 管理する届け先

    届け先 "1" *-- "1" 届け先ID : id
    届け先 "1" -- "1" ユーザーID : 登録者
    届け先 "1" -- "0..*" 記念日 : 関連記念日

    商品 "1" *-- "1" 商品ID : id
    商品 "1" -- "1" 金額 : 価格

    支払い "1" *-- "1" 支払いID : id
    支払い "1" -- "1" 予約ID : 関連予約
    支払い "1" -- "1" 金額 : 金額
    支払い "1" -- "1" 支払い状態 : 状態

    note for プレゼント予約 "プレゼント予約が集約ルート"

```

上記の図は、記念日プレゼント予約・配送サービスの主要なエンティティ (`プレゼント予約`, `届け先`, `ユーザーアカウント`, `商品`, `支払い`)、関連する値オブジェクト、およびそれらの関係性を示しています。
`プレゼント予約` が中心的な集約ルート（Aggregate Root）であり、関連する情報や状態遷移ロジックを保持します。

---

## サンプル実装由来のドメインモデル図 (既存コードとの対応用)

以下のモデル図は、初期のサンプル実装 (`src/`) に基づくものです。
**注意:** これは現在の記念日プレゼントサービスのドメインモデルとは直接対応しません。

```mermaid
classDiagram
    class 注文 {
        +注文ID
        +List<商品ID> 商品リスト
        +u32 合計金額
        +注文状態 状態
        +発送準備中へ変更() Result<注文, DomainError>
        +発送済みへ変更() Result<注文, DomainError>
        +注文キャンセル() Result<注文, DomainError>
    }
    class 商品 {
        +商品ID
        +String 名前
        +u32 価格
    }
    class 注文ID {
      <<ValueObject>>
      +Uuid value
    }
    class 商品ID {
      <<ValueObject>>
      +Uuid value
    }
    class 注文状態 {
      <<Enumeration>>
      受付済み
      発送準備中
      発送済み
      キャンセル済み
    }
    class DomainError {
      <<Enumeration>>
      注文商品空エラー
      不正な状態遷移エラー
      注文NotFound
      商品NotFound
      価格計算オーバーフロー
    }

    注文 "1" *-- "1" 注文ID : id
    注文 "1" *-- "1..*" 商品ID : 商品リスト
    注文 "1" -- "1" 注文状態 : 状態
    商品 "1" *-- "1" 商品ID : id

    note for 注文 "注文は集約ルート"
```

上記の図は、サンプル実装における主要なエンティティ (`注文`, `商品`)、値オブジェクト (`注文ID`, `商品ID`, `注文状態`)、およびそれらの基本的な関連性を示しています。
`注文`が集約ルート（Aggregate Root）であり、`注文状態`の遷移ロジックの一部をメソッドとして持っています。
`DomainError`はサンプル実装のドメイン層で発生しうるエラーの種類を示します。
